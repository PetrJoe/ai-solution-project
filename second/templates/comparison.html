<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Comparison</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <header>
        <h1>University Course Management System</h1>
        <h2>Database Comparison: PostgreSQL vs MongoDB</h2>
    </header>
    
    <nav>
        <ul>
            <li><a href="{{ url_for('index') }}">Home</a></li>
            <li><a href="{{ url_for('comparison') }}">Database Comparison</a></li>
            <li><a href="{{ url_for('init_db') }}">Initialize Databases</a></li>
        </ul>
    </nav>
    
    <main>
        <section class="comparison">
            <h2>Database Comparison</h2>
            
            <div class="comparison-container">
                <div class="postgresql">
                    <h3>PostgreSQL (Object-Relational)</h3>
                    
                    <div class="feature-box">
                        <h4>Object-Relational Features Used</h4>
                        <ul>
                            <li><strong>Inheritance:</strong> Person as a base class for Student and Faculty</li>
                            <li><strong>Array Types:</strong> For prerequisites and specializations</li>
                            <li><strong>User-Defined Types:</strong> Address as a composite type</li>
                            <li><strong>Triggers:</strong> For data validation (enrollment date check)</li>
                        </ul>
                    </div>
                    
                    <div class="query-box">
                        <h4>Complex Query Example</h4>
                        <pre>
SELECT s.name as student_name, s.student_id, c.title as course_title, 
       c.code as course_code, d.name as department_name, e.grade
FROM student s
INNER JOIN enrollment e ON s.id = e.student_id
LEFT OUTER JOIN course c ON e.course_id = c.id
FULL OUTER JOIN department d ON c.department_id = d.id
ORDER BY s.name, c.title
                        </pre>
                        
                        <button id="run-pg-query">Run Query</button>
                        <div id="pg-results" class="results"></div>
                    </div>
                </div>
                
                <div class="mongodb">
                    <h3>MongoDB (NoSQL Document Store)</h3>
                    
                    <div class="feature-box">
                        <h4>Document Store Features Used</h4>
                        <ul>
                            <li><strong>Embedded Documents:</strong> Faculty embedded in departments, enrollments embedded in students</li>
                            <li><strong>Arrays:</strong> For prerequisites, specializations, and enrolled students</li>
                            <li><strong>Denormalization:</strong> Department info embedded in courses</li>
                            <li><strong>Reduced Collections:</strong> 3 collections vs 6 tables in PostgreSQL</li>
                        </ul>
                    </div>
                    
                    <div class="query-box">
                        <h4>Complex Query Example</h4>
                        <pre>
db.courses.aggregate([
  {
    '$lookup': {
      'from': 'departments',
      'localField': 'department.name',
      'foreignField': 'name',
      'as': 'department_info'
    }
  },
  {
    '$unwind': {
      'path': '$department_info',
      'preserveNullAndEmptyArrays': true
    }
  },
  {
    '$project': {
      'code': 1,
      'title': 1,
      'department_name': '$department.name',
      'students_enrolled': 1,
      'faculty': '$department_info.faculty'
    }
  }
])
                        </pre>
                        
                        <button id="run-mongo-query">Run Query</button>
                        <div id="mongo-results" class="results"></div>
                    </div>
                </div>
            </div>
            
            <div class="critical-discussion">
                <h3>Critical Discussion: PostgreSQL vs MongoDB Implementation</h3>
                <p>
                    The PostgreSQL implementation follows a traditional object-relational approach with tables for each entity and relationships defined through foreign keys. The object-relational features like inheritance, arrays, and user-defined types enhance the model beyond a purely relational design.
                </p>
                <p>
                    In contrast, the MongoDB implementation takes advantage of document embedding to reduce the number of collections needed. By embedding faculty within departments and enrollments within students, we eliminate the need for separate collections and complex joins. This approach aligns with MongoDB's strengths in handling hierarchical data and reduces query complexity for common operations.
                </p>
                <p>
                    While PostgreSQL enforces schema and data integrity through constraints and triggers, MongoDB offers flexibility in document structure. This flexibility is particularly useful for evolving data models but requires application-level validation to ensure data consistency.
                </p>
                <p>
                    The choice between these database systems depends on the specific requirements of the application. PostgreSQL is better suited for applications with complex transactions and strict data integrity requirements, while MongoDB excels in scenarios requiring schema flexibility and hierarchical data representation.
                </p>
            </div>
        </section>
    </main>
    
    <footer>
        <p>&copy; 2023 Database Comparison Project</p>
    </footer>
    
    <script>
        $(document).ready(function() {
            $('#run-pg-query').click(function() {
                $.getJSON('/api/postgresql/complex-query', function(data) {
                    let html = '<table><tr><th>Student</th><th>Student ID</th><th>Course</th><th>Course Code</th><th>Department</th><th>Grade</th></tr>';
                    
                    data.forEach(function(row) {
                        html += `<tr>
                            <td>${row.student_name}</td>
                            <td>${row.student_id}</td>
                            <td>${row.course_title}</td>
                            <td>${row.course_code}</td>
                            <td>${row.department_name}</td>
                            <td>${row.grade}</td>
                        </tr>`;
                    });
                    
                    html += '</table>';
                    $('#pg-results').html(html);
                });
            });
            
            $('#run-mongo-query').click(function() {
                $.getJSON('/api/mongodb/complex-query', function(data) {
                    let html = '<table><tr><th>Course Code</th><th>Course Title</th><th>Department</th><th>Students Enrolled</th><th>Faculty</th></tr>';
                    
                    data.forEach(function(course) {
                        let students = course.students_enrolled.map(s => `${s.name} (${s.grade})`).join('<br>');
                        let faculty = course.faculty ? course.faculty.map(f => f.name).join('<br>') : 'None';
                        
                        html += `<tr>
                            <td>${course.code}</td>
                            <td>${course.title}</td>
                            <td>${course.department_name}</td>
                            <td>${students}</td>
                            <td>${faculty}</td>
                        </tr>`;
                    });
                    
                    html += '</table>';
                    $('#mongo-results').html(html);
                });
            });
        });
    </script>
</body>
</html>
